
-- Create the DB tables to hold the raw data.


DROP TABLE IF EXISTS _work.recent CASCADE;
CREATE TABLE _work.recent (
	election_id INT NOT NULL,
	ed_id	INT NOT NULL,
	ed_name TEXT NOT NULL,
	ed_name_fr TEXT NOT NULL,
	poll_id TEXT NOT NULL,
	poll_name TEXT NOT NULL,
	poll_void BOOLEAN NOT NULL,
	poll_not_held BOOLEAN NOT NULL,
	merge_with TEXT,
	ballots_rejected INT NOT NULL,
	num_electors INT NOT NULL,
	cand_last TEXT NOT NULL,
	cand_middle TEXT NOT NULL,
	cand_first TEXT NOT NULL,
	cand_raw_party_name TEXT NOT NULL,
	cand_party_fr TEXT NOT NULL,
	cand_incumbent BOOLEAN NOT NULL,
	elected BOOLEAN NOT NULL,
	votes INT NOT NULL
);


DROP TABLE IF EXISTS _work.history CASCADE;
CREATE TABLE _work.history (
	election_date TEXT NOT NULL,
	election_type TEXT NOT NULL,
	election_id INT NOT NULL,
	province TEXT NOT NULL,
	ed_name TEXT NOT NULL,
	cand_last TEXT NOT NULL,
	cand_first TEXT,
	cand_gender TEXT,
	cand_occupation TEXT,
	cand_raw_party_name TEXT NOT NULL,
	votes_raw TEXT,
	votes_pct REAL,
	elected BOOLEAN NOT NULL
);

DROP TABLE IF EXISTS _work.preliminary CASCADE;
CREATE TABLE _work.preliminary (
	ed_id INT NOT NULL,
	ed_name TEXT NOT NULL,
	ed_name_fr TEXT NOT NULL,
	result_type TEXT NOT NULL,
	result_type_fr TEXT NOT NULL,
	cand_last TEXT NOT NULL,
	cand_middle TEXT,
	cand_first TEXT NOT NULL,
	cand_raw_party_name TEXT NOT NULL,
	cand_party_name_fr TEXT NOT NULL,
	votes INT NOT NULL,
	votes_pct REAL NOT NULL,
	ballots_rejected INT NOT NULL,
	total_ballots_cast INT NOT NULL
);



DROP TABLE _elections.parties;
CREATE TABLE _elections.parties (
    party_code  TEXT    NOT NULL,
    party_name  TEXT    NOT NULL,
    main_stream BOOLEAN NOT NULL,

    PRIMARY KEY (party_code),
    UNIQUE (party_name)
);

COMMENT ON TABLE _elections.parties IS 'Party names and other info.';

-- Parties are 'main_stream' if they earned at least 5% of the vote in an election.
INSERT INTO _elections.parties
VALUES ('Ablish', 'Abolitionist Party of Canada', FALSE),
       ('AniAEV', 'Animal Alliance Environment Voters Party of Canada', FALSE),
       ('AniPP', 'Animal Protection Party', FALSE),
       ('AConfed', 'Anti-Confederate', TRUE),
       ('Bloc', 'Bloc Québécois', TRUE),
       ('BlocPC', 'Bloc populaire canadien', FALSE),
       ('CFF', 'CFF - Canada''s Fourth Front', TRUE),
       ('CdaP', 'Canada Party', FALSE),
       ('CAP', 'Canadian Action Party', FALSE),
       ('CAlli', 'Canadian Alliance', TRUE),
       ('CHP', 'Christian Heritage Party', FALSE),
       ('CCF', 'Co-operative Commonwealth Federation', TRUE),
       ('Com', 'Communist Party of Canada', FALSE),
       ('CRWest', 'Confederation of Regions Western Party', FALSE),
       ('Con', 'Conservative Party of Canada', TRUE),
       ('FstPpl', 'First Peoples National Party of Canada', FALSE),
       ('FDemo', 'Forces et Démocratie - Allier les forces de nos régions', FALSE),
       ('Govt', 'Government', TRUE),
       ('Grn', 'Green Party of Canada', TRUE),
       ('Ind', 'Independent', FALSE),
       ('Labour', 'Labour', FALSE),
       ('LabPP', 'Labour Progressive Party', FALSE),
       ('Lib', 'Liberal', TRUE),
       ('LibLP', 'Liberal Labour Party', FALSE),
       ('LibPro', 'Liberal Progressive', FALSE),
       ('LibCon', 'Liberal-Conservative', TRUE),
       ('Libtar', 'Libertarian Party of Canada', FALSE),
       ('Marij', 'Marijuana Party', FALSE),
       ('M-L', 'Marxist-Leninist Party', FALSE),
       ('McCart', 'McCarthyite', FALSE),
       ('NCA', 'National Citizens Alliance', FALSE),
       ('NGovt', 'National Government', TRUE),
       ('NPC', 'National Party of Canada', FALSE),
       ('Ntnlst', 'Nationalist', FALSE),
       ('NLP', 'Natural Law Party of Canada', FALSE),
       ('NDemo', 'New Democracy', FALSE),
       ('NDP', 'New Democratic Party', TRUE),
       ('Opp', 'Opposition', TRUE),
       ('PNQ', 'Parti Nationaliste du Québec', FALSE),
       ('Comwlth', 'Party for the Commonwealth of Canada', FALSE),
       ('PInd', 'Patrons of Industry', FALSE),
       ('PPC', 'People''s Party', FALSE),
       ('Pirate', 'Pirate Party of Canada', FALSE),
       ('IndQ', 'Pour l''Indépendance du Québec', FALSE),
       ('Prog', 'Progressive', TRUE),
       ('PCdnP', 'Progressive Canadian Party', FALSE),
       ('PC', 'Progressive Conservative Party', TRUE),
       ('RCred', 'Ralliement Créditiste', TRUE),
       ('ReconP', 'Reconstruction Party', TRUE),
       ('Reform', 'Reform Party of Canada', TRUE),
       ('Rhino', 'Rhinoceros', FALSE),
       ('SoCred', 'Social Credit Party of Canada', TRUE),
       ('Social', 'Socialist', FALSE),
       ('SCChg', 'Stop Climate Change', FALSE),
       ('UPop', 'Union Populaire', FALSE),
       ('UElect', 'Union of Electors', FALSE),
       ('UFarm', 'United Farmers', FALSE),
       ('Unknown', 'Unknown', FALSE),
       ('VCP', 'VCP', FALSE),
       ('WestBP', 'Western Block Party', FALSE);



DROP TABLE _work.party_name_lookup CASCADE;
CREATE TABLE _work.party_name_lookup (
    raw_party_name   TEXT NOT NULL,
    party_code TEXT NOT NULL,
    PRIMARY KEY (raw_party_name)
);

COMMENT ON TABLE _work.party_name_lookup IS 'Normalize names to just one common name across all elections.';
-- This list was created by extracting all the party names from elections 1 through 42 and then
-- and then reviewing it by hand.  The obvious differences were collapsed into one name (eg "N.D.P."
-- and "NDP-New Democratic Party").  Minimal research was done.

INSERT INTO _work.party_name_lookup (raw_party_name, party_code)
VALUES 
	('Abolitionist Party of Canada', 'Ablish'),
	('Animal Alliance Environment Voters Party of Canada', 'AniAEV'),
	('Animal Alliance/Environment Voters', 'AniAEV'),
	('Animal Protection Party', 'AniPP'),
	('Anti-Confederate', 'AConfed'),
	('Bloc Québécois', 'Bloc'),
	('Bloc populaire canadien', 'BlocPC'),
	('Canada Party', 'CdaP'),
	('Canadian Action', 'CAP'),
	('Canadian Action Party', 'CAP'),
	('CAP', 'CAP'),
	('Canadian Alliance', 'CAlli'),
	('CFF - Canada''s Fourth Front', 'CFF'),
	('Christian Heritage Party', 'CHP'),
	('Christian Heritage Party of Canada', 'CHP'),
	('CHP Canada', 'CHP'),
	('Co-operative Commonwealth Federation', 'CCF'),
	('Communist', 'Com'),
	('Communist Party of Canada', 'Com'),
	('Confederation of Regions Western Party', 'CRWest'),
	('Conservative', 'Con'),
	('Conservative Party of Canada', 'Con'),
	('First Peoples National Party of Canada', 'FstPpl'),
	('Forces et Démocratie - Allier les forces de nos régions', 'FDemo'),
	('Government', 'Govt'),
	('Green Party', 'Grn'),
	('Green Party of Canada', 'Grn'),
	('Independent', 'Ind'),
	('Independent Co-operative Commonwealth Federation', 'Ind'),
	('Independent Conservative', 'Ind'),
	('Independent Labor', 'Ind'),
	('Independent Liberal', 'Ind'),
	('Independent Liberal Progressive', 'Ind'),
	('Independent Nationalist', 'Ind'),
	('Independent Progressive', 'Ind'),
	('Independent Progressive Conservative', 'Ind'),
	('Independent Reconstruction Party', 'Ind'),
	('Independent Social Credit', 'Ind'),
	('No Affiliation', 'Ind'),
	('No affiliation to a recognised party', 'Ind'),
	('Locataire (candidat)', 'Ind'),
	('AACEV Party of Canada', 'Ind'),
	('ATN', 'Ind'),
	('All Canadian Party', 'Ind'),
	('Anti-Communist', 'Ind'),
	('Anti-Conscriptionist', 'Ind'),
	('Autonomist', 'Ind'),
	('Canadian Democrat', 'Ind'),
	('Canadian Labour', 'Ind'),
	('Canadian Party', 'Ind'),
	('Candidat libéral des électeurs', 'Ind'),
	('Candidats des électeurs', 'Ind'),
	('Capital  familial', 'Ind'),
	('Christian Liberal', 'Ind'),
	('Conservative-Labour', 'Ind'),
	('Cooperative Builders of Canada', 'Ind'),
	('Democrat', 'Ind'),
	('Democratic Advancement', 'Ind'),
	('Droit vital personnel', 'Ind'),
	('Equal Rights', 'Ind'),
	('Esprit social', 'Ind'),
	('FPNP', 'Ind'),
	('Farmer', 'Ind'),
	('Farmer Labour', 'Ind'),
	('Farmer-United Labour', 'Ind'),
	('Franc Lib', 'Ind'),
	('Labour Farmer', 'Ind'),
	('Liberal Conservative Coalition', 'Ind'),
	('Liberal Labour Progressive', 'Ind'),
	('Liberal Protectionist', 'Ind'),
	('National Citizens Alliance', 'NCA'),
	('National Credit Control', 'Ind'),
	('National Labour', 'Ind'),
	('National Liberal Progressive', 'Ind'),
	('National Liberal and Conservative Party', 'Ind'),
	('National Socialist', 'Ind'),
	('National Unity', 'Ind'),
	('Nationalist Conservative', 'Ind'),
	('Nationalist Liberal', 'Ind'),
	('New Canada Party', 'Ind'),
	('New Party', 'Ind'),
	('Newfoundland and Labrador First Party', 'Ind'),
	('Non-Partisan League', 'Ind'),
	('Opposition-Labour', 'Ind'),
	('Ouvrier indépendent', 'Ind'),
	('PACT', 'Ind'),
	('Parti de la Démocratisation Économique', 'Ind'),
	('Parti humain familial', 'Ind'),
	('Parti ouvrier canadien', 'Ind'),
	('People''s Political Power Party of Canada', 'Ind'),
	('Progressive Workers Movement', 'Ind'),
	('Prohibition', 'Ind'),
	('Protectionist', 'Ind'),
	('Protestant Protective Association', 'Ind'),
	('Radical chrétien', 'Ind'),
	('Republican', 'Ind'),
	('Republican Party', 'Ind'),
	('Seniors Party', 'Ind'),
	('Social Credit-National Unity', 'Ind'),
	('Socialist Labour', 'Ind'),
	('Stop Climate Change', 'SCChg'),
	('Technocrat', 'Ind'),
	('The Bridge', 'Ind'),
	('Trades Union', 'Ind'),
	('United Party', 'Ind'),
	('United Party of Canada', 'Ind'),
	('UPC', 'Ind'),
	('United Progressive', 'Ind'),
	('United Reform', 'Ind'),
	('United Reform Movement', 'Ind'),
	('Unity', 'Ind'),
	('Unité nationale', 'Ind'),
	('Verdun', 'Ind'),
	('Veterans Party', 'Ind'),
	('Work Less Party', 'Ind'),
	('Labour', 'Labour'),
	('Labour Progressive Party', 'LabPP'),
	('Liberal', 'Lib'),
	('Liberal Labour', 'LibLP'),
	('Liberal Labour Party', 'LibLP'),
	('Liberal Progressive', 'LibPro'),
	('Liberal-Conservative', 'LibCon'),
	('Libertarian', 'Libtar'),
	('Libertarian Party of Canada', 'Libtar'),
	('Marijuana Party', 'Marij'),
	('Radical Marijuana', 'Marij'),
	('Marxist-Leninist', 'M-L'),
	('Marxist-Leninist Party', 'M-L'),
	('ML', 'M-L'),
	('McCarthyite', 'McCart'),
	('N.D.P.', 'NDP'),
	('NDP-New Democratic Party', 'NDP'),
	('New Democratic Party', 'NDP'),
	('National Government', 'NGovt'),
	('National Party of Canada', 'NPC'),
	('Nationalist', 'Ntnlst'),
	('Natural Law Party of Canada', 'NLP'),
	('New Democracy', 'NDemo'),
	('Opposition', 'Opp'),
	('Parti Nationaliste du Québec', 'PNQ'),
	('Party for the Commonwealth of Canada', 'Comwlth'),
	('Patrons of Industry', 'PInd'),
	('People''s Party', 'PPC'),
	('Pirate', 'Pirate'),
	('Pirate Party', 'Pirate'),
	('Pirate Party of Canada', 'Pirate'),
	('Progressive', 'Prog'),
	('Progressive Canadian Party', 'PCdnP'),
	('Progressive Conservative', 'PC'),
	('PC Party', 'PC'),
	('Pour l''Indépendance du Québec', 'IndQ'),
	('Ralliement Créditiste', 'RCred'),
	('Reconstruction Party', 'ReconP'),
	('Reform', 'Reform'),
	('Reform Party of Canada', 'Reform'),
	('Rhinoceros', 'Rhino'),
	('neorhino.ca', 'Rhino'),
	('Parti Rhinocéros', 'Rhino'),
	('Parti Rhinocéros Party', 'Rhino'),
	('Social Credit Party of Canada', 'SoCred'),
	('Socialist', 'Social'),
	('Union Populaire', 'UPop'),
	('Union of Electors', 'UElect'),
	('United Farmers', 'UFarm'),
	('United Farmers of Alberta', 'UFarm'),
	('United Farmers of Ontario', 'UFarm'),
	('United Farmers of Ontario-Labour', 'UFarm'),
	('United Farmers-Labour', 'UFarm'),
	('Unknown', 'Unknown'),
	('VCP', 'VCP'),
	('WBP', 'WestBP'),
	('Western Block Party', 'WestBP');

DROP TABLE IF EXISTS _work.prov_lookup CASCADE;
CREATE TABLE _work.prov_lookup (
    raw_prov_code  TEXT NOT NULL,
    prov_code TEXT NOT NULL,

    PRIMARY KEY (raw_prov_code)
);

COMMENT ON TABLE _work.prov_lookup IS 'A look-up table to normalize province codes.';

-- For recent data, the province info is embedded in the first two digits electoral district id.
-- For historical data, it's spelled out.
INSERT INTO _work.prov_lookup (raw_prov_code, prov_code)
VALUES ('48', 'AB'),
       ('59', 'BC'),
       ('46', 'MB'),
       ('13', 'NB'),
       ('10', 'NL'),
       ('12', 'NS'),
       ('61', 'NT'),
       ('62', 'NU'),
       ('35', 'ON'),
       ('11', 'PE'),
       ('24', 'QC'),
       ('47', 'SK'),
       ('60', 'YK'),
       ('Saskatchewan', 'SK'),
       ('New Brunswick', 'NB'),
       ('Quebec', 'QC'),
       ('Newfoundland and Labrador', 'NL'),
       ('Manitoba', 'MB'),
       ('Nunavut', 'NU'),
       ('Alberta', 'AB'),
       ('British Columbia', 'BC'),
       ('Yukon', 'YK'),
       ('Northwest Territories', 'NT'),
       ('Prince Edward Island', 'PE'),
       ('Ontario', 'ON'),
       ('Nova Scotia', 'NS')
       ;

